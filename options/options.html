<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QBittorrent Remote Connection - Settings</title>
    <link href="../vendor/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link
      href="../vendor/bootstrap-icons/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/options.css" />
  </head>
  <body class="bg-dark text-light">
    <div class="container py-4" style="max-width: 800px">
      <header class="mb-4">
        <h1 class="display-6 text-primary">
          <i class="bi bi-cloud-arrow-down me-3"></i>QBittorrent Remote
          Connection
        </h1>
        <p class="lead text-muted">
          Configure your QBittorrent server connection settings
        </p>
      </header>

      <main>
        <form id="configForm">
          <div class="card bg-dark border-secondary mb-4">
            <div class="card-header bg-primary">
              <h2 class="h5 mb-0 text-white">
                <i class="bi bi-server me-2"></i>Server Configuration
              </h2>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label for="serverUrl" class="form-label">
                  <i class="bi bi-globe me-1"></i>Server URL/IP Address:
                </label>
                <input
                  type="text"
                  class="form-control bg-dark border-secondary text-light"
                  id="serverUrl"
                  name="serverUrl"
                  placeholder="192.168.1.100 or qbittorrent.local"
                  required
                />
                <div class="form-text">
                  Enter the IP address or hostname of your QBittorrent server
                </div>
              </div>

              <div class="mb-3">
                <label for="port" class="form-label">
                  <i class="bi bi-ethernet me-1"></i>Port:
                </label>
                <input
                  type="number"
                  class="form-control bg-dark border-secondary text-light"
                  id="port"
                  name="port"
                  placeholder="8080"
                  min="1"
                  max="65535"
                  required
                />
                <div class="form-text">
                  Default QBittorrent Web UI port is 8080
                </div>
              </div>

              <div class="form-check mb-3">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="useHttps"
                  name="useHttps"
                />
                <label class="form-check-label" for="useHttps">
                  <i class="bi bi-shield-lock me-1"></i>Use HTTPS (SSL/TLS)
                </label>
                <div class="form-text">
                  Enable if your QBittorrent server uses HTTPS
                </div>
              </div>
            </div>
          </div>

          <div class="card bg-dark border-secondary mb-4">
            <div class="card-header bg-success">
              <h2 class="h5 mb-0 text-white">
                <i class="bi bi-person-lock me-2"></i>Authentication
              </h2>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label for="username" class="form-label">
                  <i class="bi bi-person me-1"></i>Username:
                </label>
                <input
                  type="text"
                  class="form-control bg-dark border-secondary text-light"
                  id="username"
                  name="username"
                  autocomplete="username"
                />
                <div class="form-text">QBittorrent Web UI username</div>
              </div>

              <div class="mb-3">
                <label for="password" class="form-label">
                  <i class="bi bi-key me-1"></i>Password:
                </label>
                <input
                  type="password"
                  class="form-control bg-dark border-secondary text-light"
                  id="password"
                  name="password"
                  autocomplete="current-password"
                />
                <div class="form-text">QBittorrent Web UI password</div>
              </div>

              <div class="form-check mb-3">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="autoLogin"
                  name="autoLogin"
                />
                <label class="form-check-label" for="autoLogin">
                  <i class="bi bi-key-fill me-1"></i>Auto-login when extension
                  opens
                </label>
                <div class="form-text">
                  Automatically authenticate when using the extension
                </div>
              </div>
            </div>
          </div>

          <div class="d-flex gap-2 mb-4">
            <button
              type="button"
              id="testConnection"
              class="btn btn-outline-warning"
            >
              <span class="btn-text">
                <i class="bi bi-lightning me-1"></i>Test Connection
              </span>
              <span
                class="spinner-border spinner-border-sm"
                style="display: none"
                role="status"
              ></span>
            </button>
            <button type="submit" id="saveConfig" class="btn btn-primary">
              <span class="btn-text">
                <i class="bi bi-check-circle me-1"></i>Save Configuration
              </span>
              <span
                class="spinner-border spinner-border-sm"
                style="display: none"
                role="status"
              ></span>
            </button>
          </div>

          <!-- Debug Tools Section -->
          <div class="card bg-dark border-secondary mb-4">
            <div class="card-header bg-warning text-dark">
              <h3 class="h6 mb-0">
                <i class="bi bi-bug me-2"></i>Debug & Troubleshooting Tools
              </h3>
            </div>
            <div class="card-body">
              <div class="row g-2 mb-3">
                <div class="col-md-4">
                  <button
                    type="button"
                    id="testBasicFetch"
                    class="btn btn-outline-info w-100 btn-sm"
                  >
                    <i class="bi bi-arrow-right-circle me-1"></i>Test Basic
                    Fetch
                  </button>
                </div>
                <div class="col-md-4">
                  <button
                    type="button"
                    id="testVersionApi"
                    class="btn btn-outline-info w-100 btn-sm"
                  >
                    <i class="bi bi-info-circle me-1"></i>Test Version API
                  </button>
                </div>
                <div class="col-md-4">
                  <button
                    type="button"
                    id="testTorrentsApi"
                    class="btn btn-outline-info w-100 btn-sm"
                  >
                    <i class="bi bi-list-ul me-1"></i>Test Torrents API
                  </button>
                </div>
                <div class="col-md-4">
                  <button
                    type="button"
                    id="testWithCurl"
                    class="btn btn-outline-warning w-100 btn-sm"
                  >
                    <i class="bi bi-terminal me-1"></i>Show Curl Commands
                  </button>
                </div>
                <div class="col-md-4">
                  <button
                    type="button"
                    id="testCorsMode"
                    class="btn btn-outline-secondary w-100 btn-sm"
                  >
                    <i class="bi bi-shield-check me-1"></i>Test CORS Modes
                  </button>
                </div>
                <div class="col-md-4">
                  <button
                    type="button"
                    id="clearDebugLog"
                    class="btn btn-outline-danger w-100 btn-sm"
                  >
                    <i class="bi bi-trash me-1"></i>Clear Debug Log
                  </button>
                </div>
                <div class="col-md-4">
                  <button
                    type="button"
                    id="showHttpsOnlyHelp"
                    class="btn btn-outline-success w-100 btn-sm"
                  >
                    <i class="bi bi-question-circle me-1"></i>HTTPS-Only Help
                  </button>
                </div>
                <div class="col-md-4">
                  <button
                    type="button"
                    id="fixHttpsOnlyMode"
                    class="btn btn-warning w-100 btn-sm"
                  >
                    <i class="bi bi-shield-x me-1"></i>Fix HTTPS-Only Mode
                  </button>
                </div>
              </div>

              <!-- Quick Fix Row for common issue -->
              <div class="row g-2 mb-3">
                <div class="col-12">
                  <div class="alert alert-info border-info mb-0">
                    <strong
                      ><i class="bi bi-lightbulb me-1"></i>Quick Fix:</strong
                    >
                    If you're getting "NetworkError", click
                    <button
                      type="button"
                      class="btn btn-warning btn-sm mx-1"
                      id="quickFixHttpsOnlyMode"
                    >
                      <i class="bi bi-shield-x me-1"></i>Fix HTTPS-Only Mode
                    </button>
                    to get step-by-step instructions.
                  </div>
                </div>
              </div>

              <!-- Debug Log Output -->
              <div id="debugLog" style="display: none">
                <h6 class="text-info">
                  <i class="bi bi-terminal me-1"></i>Debug Log:
                </h6>
                <pre
                  class="bg-black text-light p-3 rounded border border-secondary"
                  style="font-size: 0.85em; max-height: 300px; overflow-y: auto"
                ><code id="debugOutput"></code></pre>
              </div>
            </div>
          </div>
        </form>

        <div
          id="statusMessage"
          class="alert border-0"
          style="display: none"
          role="alert"
        >
          <span class="status-text"></span>
        </div>

        <div
          id="connectionResult"
          class="card bg-dark border-secondary"
          style="display: none"
        >
          <div class="card-header">
            <h3 class="h6 mb-0">
              <i class="bi bi-check-circle-fill text-success me-2"></i
              >Connection Test Result
            </h3>
          </div>
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="text-muted">
                <i class="bi bi-server me-1"></i>Server:
              </span>
              <span id="testServerUrl" class="font-monospace text-info">-</span>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="text-muted">
                <i class="bi bi-info-circle me-1"></i>Version:
              </span>
              <span id="testServerVersion" class="font-monospace text-success"
                >-</span
              >
            </div>
            <div class="d-flex justify-content-between align-items-center">
              <span class="text-muted">
                <i class="bi bi-stopwatch me-1"></i>Response Time:
              </span>
              <span id="testResponseTime" class="font-monospace text-warning"
                >-</span
              >
            </div>
          </div>
        </div>

        <div class="card bg-dark border-secondary mt-4">
          <div class="card-header bg-info">
            <h3 class="h6 mb-0 text-white">
              <i class="bi bi-info-circle me-2"></i>Setup Instructions
            </h3>
          </div>
          <div class="card-body">
            <ol class="mb-3">
              <li>
                Ensure QBittorrent Web UI is enabled in QBittorrent settings
              </li>
              <li>
                Note the Web UI port (usually 8080) and IP address of your
                QBittorrent server
              </li>
              <li>Enter your QBittorrent Web UI username and password</li>
              <li>Test the connection to verify settings</li>
              <li>Save your configuration</li>
            </ol>

            <div class="alert alert-warning border-0" role="alert">
              <i class="bi bi-shield-exclamation me-2"></i>
              <strong>Security Note:</strong> Your credentials are stored
              locally in your browser and are only sent to your configured
              QBittorrent server.
            </div>
          </div>
        </div>
      </main>
    </div>

    <script src="../vendor/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="../js/options.js"></script>
  </body>
</html>
